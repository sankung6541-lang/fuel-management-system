<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../styles.css">
</head>

<body data-theme="light">
    <button class="mobile-menu-toggle"><i class="fas fa-bars"></i></button>
    <div class="sidebar-overlay"></div>

    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üõ°Ô∏è</div>
                <div>
                    <div class="sidebar-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</div>
                    <div class="sidebar-subtitle">‡∏Å‡∏≠‡∏á‡∏û‡∏±‡∏ô‡∏ó‡∏´‡∏≤‡∏£‡∏£‡∏≤‡∏ö</div>
                </div>
            </div>
            <ul class="nav-menu"></ul>
            <div class="sidebar-user">
                <div class="user-info"></div>
                <a href="#" class="nav-link" id="logoutBtn"><i
                        class="fas fa-sign-out-alt"></i><span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span></a>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title"><i class="fas fa-car"></i> ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏´‡∏ô‡πà‡∏ß‡∏¢</h1>
                    <p class="page-subtitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢</p>
                </div>
                <button class="btn btn-primary" onclick="showModal()"><i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ</button>
            </div>

            <!-- Summary -->
            <div class="stat-cards mb-3">
                <div class="stat-card">
                    <div class="stat-icon primary"><i class="fas fa-car"></i></div>
                    <div class="stat-content">
                        <div class="stat-label">‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="stat-value" id="totalVehicles">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon diesel"><i class="fas fa-oil-can"></i></div>
                    <div class="stat-content">
                        <div class="stat-label">‡∏£‡∏ñ‡∏î‡∏µ‡πÄ‡∏ã‡∏•</div>
                        <div class="stat-value" id="dieselVehicles">0</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon benzin95"><i class="fas fa-gas-pump"></i></div>
                    <div class="stat-content">
                        <div class="stat-label">‡∏£‡∏ñ‡πÄ‡∏ö‡∏ô‡∏ã‡∏¥‡∏ô</div>
                        <div class="stat-value" id="benzinVehicles">0</div>
                    </div>
                </div>
            </div>

            <!-- Vehicles Table -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-list"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ</h3>
                </div>
                <div class="card-body" style="padding:0">
                    <div class="table-container" id="vehiclesTable"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="vehicleModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà</h3>
                <button class="modal-close" onclick="hideModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="vehicleForm">
                    <input type="hidden" id="vehicleId">
                    <div class="form-group">
                        <label class="form-label">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ <span class="required">*</span></label>
                        <input type="text" class="form-control" id="plate" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ó‡∏ö 1234">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ <span class="required">*</span></label>
                            <select class="form-control form-select" id="vehicleType" required>
                                <option value="‡∏£‡∏ñ‡∏à‡∏¥‡πä‡∏õ">‡∏£‡∏ñ‡∏à‡∏¥‡πä‡∏õ</option>
                                <option value="‡∏£‡∏ñ‡πÄ‡∏Å‡πã‡∏á">‡∏£‡∏ñ‡πÄ‡∏Å‡πã‡∏á</option>
                                <option value="‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å">‡∏£‡∏ñ‡∏ö‡∏£‡∏£‡∏ó‡∏∏‡∏Å</option>
                                <option value="‡∏£‡∏ñ‡∏ï‡∏π‡πâ">‡∏£‡∏ñ‡∏ï‡∏π‡πâ</option>
                                <option value="‡∏£‡∏ñ‡∏Å‡∏£‡∏∞‡∏ö‡∏∞">‡∏£‡∏ñ‡∏Å‡∏£‡∏∞‡∏ö‡∏∞</option>
                                <option value="‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå">‡∏£‡∏ñ‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô‡∏¢‡∏ô‡∏ï‡πå</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</label>
                            <input type="text" class="form-control" id="brand" placeholder="‡πÄ‡∏ä‡πà‡∏ô Toyota">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô <span class="required">*</span></label>
                            <select class="form-control form-select" id="fuelType" required>
                                <option value="diesel">‡∏î‡∏µ‡πÄ‡∏ã‡∏•</option>
                                <option value="benzin95">‡πÄ‡∏ö‡∏ô‡∏ã‡∏¥‡∏ô 95</option>
                                <option value="benzin91">‡πÄ‡∏ö‡∏ô‡∏ã‡∏¥‡∏ô 91</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="required">*</span></label>
                            <input type="text" class="form-control" id="department" required
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≠‡∏á‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏≤‡∏£">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-primary" onclick="saveVehicle()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script src="../utils.js"></script>
    <script src="../data.js"></script>
    <script src="../auth.js"></script>
    <script src="../google-sheets.js"></script>
    <script src="../vehicles.js"></script>
    <script src="../app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (!Auth.isAdmin() && !Auth.isOfficer()) {
                window.location.href = 'dashboard.html';
                return;
            }
            loadVehicles();
        });

        function loadVehicles() {
            const vehicles = VehicleRegistry.getAll();

            // Summary
            document.getElementById('totalVehicles').textContent = vehicles.length;
            document.getElementById('dieselVehicles').textContent = vehicles.filter(v => v.fuelType === 'diesel').length;
            document.getElementById('benzinVehicles').textContent = vehicles.filter(v => v.fuelType !== 'diesel').length;

            // Table
            if (vehicles.length === 0) {
                document.getElementById('vehiclesTable').innerHTML = '<div class="empty-state"><i class="fas fa-car"></i><h3>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏ñ</h3><p>‡∏Ñ‡∏•‡∏¥‡∏Å "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà</p></div>';
                return;
            }

            document.getElementById('vehiclesTable').innerHTML = `
                <table class="table">
                    <thead><tr><th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th><th>‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th></th></tr></thead>
                    <tbody>
                        ${vehicles.map(v => `
                            <tr>
                                <td><strong>${v.plate}</strong></td>
                                <td>${v.type}</td>
                                <td>${v.brand || '-'}</td>
                                <td><span class="badge badge-${v.fuelType}">${Utils.getFuelTypeName(v.fuelType)}</span></td>
                                <td>${v.department}</td>
                                <td><span class="badge ${v.active ? 'badge-approved' : 'badge-rejected'}">${v.active ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}</span></td>
                                <td class="table-actions">
                                    <button class="btn btn-sm btn-secondary" onclick="editVehicle('${v.id}')"><i class="fas fa-edit"></i></button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteVehicle('${v.id}')"><i class="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        function showModal(vehicle = null) {
            document.getElementById('modalTitle').textContent = vehicle ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏ñ' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('vehicleId').value = vehicle ? vehicle.id : '';
            document.getElementById('plate').value = vehicle ? vehicle.plate : '';
            document.getElementById('vehicleType').value = vehicle ? vehicle.type : '‡∏£‡∏ñ‡∏à‡∏¥‡πä‡∏õ';
            document.getElementById('brand').value = vehicle ? vehicle.brand : '';
            document.getElementById('fuelType').value = vehicle ? vehicle.fuelType : 'diesel';
            document.getElementById('department').value = vehicle ? vehicle.department : '';
            document.getElementById('vehicleModal').classList.add('active');
        }

        function hideModal() {
            document.getElementById('vehicleModal').classList.remove('active');
        }

        function editVehicle(id) {
            const vehicle = VehicleRegistry.getById(id);
            if (vehicle) showModal(vehicle);
        }

        async function deleteVehicle(id) {
            if (!await Utils.confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏ñ‡∏ô‡∏µ‡πâ?')) return;
            VehicleRegistry.delete(id);
            Utils.showToast('‡∏•‡∏ö‡∏£‡∏ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            loadVehicles();
        }

        function saveVehicle() {
            const id = document.getElementById('vehicleId').value;
            const vehicle = {
                plate: document.getElementById('plate').value.trim(),
                type: document.getElementById('vehicleType').value,
                brand: document.getElementById('brand').value.trim(),
                fuelType: document.getElementById('fuelType').value,
                department: document.getElementById('department').value.trim()
            };

            if (!vehicle.plate || !vehicle.department) {
                Utils.showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö', 'warning');
                return;
            }

            if (id) {
                VehicleRegistry.update(id, vehicle);
                Utils.showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } else {
                VehicleRegistry.add(vehicle);
                Utils.showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            }

            hideModal();
            loadVehicles();
        }
    </script>
</body>

</html>