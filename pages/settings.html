<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../styles.css">
</head>

<body data-theme="light">
    <button class="mobile-menu-toggle"><i class="fas fa-bars"></i></button>
    <div class="sidebar-overlay"></div>

    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üõ°Ô∏è</div>
                <div>
                    <div class="sidebar-title">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</div>
                    <div class="sidebar-subtitle">‡∏Å‡∏≠‡∏á‡∏û‡∏±‡∏ô‡∏ó‡∏´‡∏≤‡∏£‡∏£‡∏≤‡∏ö</div>
                </div>
            </div>
            <ul class="nav-menu"></ul>
            <div class="sidebar-user">
                <div class="user-info"></div>
                <a href="#" class="nav-link" id="logoutBtn"><i
                        class="fas fa-sign-out-alt"></i><span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span></a>
            </div>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title"><i class="fas fa-cogs"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h1>
                    <p class="page-subtitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏î‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô, Google Sheets ‡πÅ‡∏•‡∏∞ LINE Notify</p>
                </div>
            </div>

            <!-- Google Sheets Settings -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title"><i class="fab fa-google-drive"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-2">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠:</strong> ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Sheets > Extensions > Apps Script > ‡∏ß‡∏≤‡∏á Code
                            ‡∏à‡∏≤‡∏Å <code>Code.gs</code> > Deploy as Web app > Copy URL ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
                        </div>
                    </div>
                    <form id="googleSheetsForm">
                        <div class="form-group">
                            <label class="form-label">Web App URL</label>
                            <input type="url" class="form-control" id="webAppUrl"
                                placeholder="https://script.google.com/macros/s/xxx/exec">
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                            <button type="button" class="btn btn-success" onclick="testConnection()"><i
                                    class="fas fa-plug"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
                            <button type="button" class="btn btn-warning" onclick="syncNow()"><i
                                    class="fas fa-sync-alt"></i> Sync</button>
                        </div>
                    </form>
                    <div id="connectionStatus" class="mt-2"></div>
                </div>
            </div>

            <!-- Telegram Bot Settings -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title"><i class="fab fa-telegram"></i> Telegram Bot</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-info mb-2">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>‡∏ß‡∏¥‡∏ò‡∏µ‡∏™‡∏£‡πâ‡∏≤‡∏á Bot:</strong><br>
                            1. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ <code>@BotFather</code> ‡πÉ‡∏ô Telegram<br>
                            2. ‡∏û‡∏¥‡∏°‡∏û‡πå <code>/newbot</code> ‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠<br>
                            3. Copy Token ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ<br>
                            4. ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ<br>
                            5. ‡πÑ‡∏õ <code>https://api.telegram.org/bot{TOKEN}/getUpdates</code> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π Chat ID
                        </div>
                    </div>
                    <form id="telegramForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Bot Token</label>
                                <input type="text" class="form-control" id="botToken"
                                    placeholder="123456789:ABCdefGHIjklMNOpqrSTUvwxYZ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Chat ID</label>
                                <input type="text" class="form-control" id="chatId" placeholder="-1001234567890">
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                            <button type="button" class="btn btn-success" onclick="testTelegram()"><i
                                    class="fas fa-paper-plane"></i> ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á</button>
                        </div>
                    </form>
                    <div id="telegramStatus" class="mt-2"></div>
                </div>
            </div>

            <!-- Inventory Settings -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-oil-can"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏¢‡∏≠‡∏î‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</h3>
                </div>
                <div class="card-body">
                    <form id="inventoryForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">‡∏î‡∏µ‡πÄ‡∏ã‡∏• (‡∏•‡∏¥‡∏ï‡∏£)</label>
                                <input type="number" class="form-control" id="dieselAmount" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡πÄ‡∏ö‡∏ô‡∏ã‡∏¥‡∏ô 95 (‡∏•‡∏¥‡∏ï‡∏£)</label>
                                <input type="number" class="form-control" id="benzin95Amount" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡πÄ‡∏ö‡∏ô‡∏ã‡∏¥‡∏ô 91 (‡∏•‡∏¥‡∏ï‡∏£)</label>
                                <input type="number" class="form-control" id="benzin91Amount" min="0">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i>
                            ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</button>
                    </form>
                </div>
            </div>

            <!-- Add Fuel -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-truck-loading"></i> ‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á</h3>
                </div>
                <div class="card-body">
                    <form id="addFuelForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</label>
                                <select class="form-control form-select" id="addFuelType" required>
                                    <option value="diesel">‡∏î‡∏µ‡πÄ‡∏ã‡∏•</option>
                                    <option value="benzin95">‡πÄ‡∏ö‡∏ô‡∏ã‡∏¥‡∏ô 95</option>
                                    <option value="benzin91">‡πÄ‡∏ö‡∏ô‡∏ã‡∏¥‡∏ô 91</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (‡∏•‡∏¥‡∏ï‡∏£)</label>
                                <input type="number" class="form-control" id="addLiters" min="1" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                            <input type="text" class="form-control" id="addNote"
                                placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å ‡∏õ‡∏ï‡∏ó., ‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà...">
                        </div>
                        <button type="submit" class="btn btn-success"><i class="fas fa-plus-circle"></i>
                            ‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤</button>
                    </form>
                </div>
            </div>

            <!-- Auto Sync Settings -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-sync-alt"></i> Auto Sync</h3>
                </div>
                <div class="card-body">
                    <div class="d-flex align-center justify-between">
                        <div>
                            <strong>Sync ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ</strong>
                            <p class="text-muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ Sync ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="autoSyncToggle" checked onchange="toggleAutoSync()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Backup/Restore -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title"><i class="fas fa-database"></i> ‡∏™‡∏≥‡∏£‡∏≠‡∏á/‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                </div>
                <div class="card-body">
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="backupData()"><i class="fas fa-download"></i>
                            ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <label class="btn btn-secondary"><i class="fas fa-upload"></i> ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<input type="file"
                                id="restoreFile" accept=".json" style="display:none"
                                onchange="restoreData(this)"></label>
                    </div>
                </div>
            </div>

            <!-- Reset -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title text-danger"><i class="fas fa-exclamation-triangle"></i> ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö</h3>
                </div>
                <div class="card-body">
                    <p class="text-muted">‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!</strong></p>
                    <button class="btn btn-danger" onclick="resetSystem()"><i class="fas fa-trash-alt"></i>
                        ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
            </div>
        </main>
    </div>

    <script src="../utils.js"></script>
    <script src="../data.js"></script>
    <script src="../auth.js"></script>
    <script src="../google-sheets.js"></script>
    <script src="../line-notify.js"></script>
    <script src="../auto-sync.js"></script>
    <script src="../app.js"></script>
    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--success);
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (!Auth.isAdmin()) {
                Utils.showToast('‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'danger');
                window.location.href = 'dashboard.html';
                return;
            }
            loadInventory();
            loadGoogleSheetsConfig();
            loadTelegramConfig();
        });

        function loadInventory() {
            const inv = DataManager.getInventory();
            document.getElementById('dieselAmount').value = inv.diesel.current;
            document.getElementById('benzin95Amount').value = inv.benzin95.current;
            document.getElementById('benzin91Amount').value = inv.benzin91.current;
        }

        function loadGoogleSheetsConfig() {
            document.getElementById('webAppUrl').value = GoogleSheets.WEB_APP_URL || '';
        }

        function loadTelegramConfig() {
            document.getElementById('botToken').value = TelegramNotify.BOT_TOKEN || '';
            document.getElementById('chatId').value = TelegramNotify.CHAT_ID || '';
        }

        document.getElementById('googleSheetsForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const url = document.getElementById('webAppUrl').value.trim();
            GoogleSheets.setWebAppUrl(url);
            Utils.showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        });

        document.getElementById('telegramForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const botToken = document.getElementById('botToken').value.trim();
            const chatId = document.getElementById('chatId').value.trim();
            TelegramNotify.setConfig(botToken, chatId);
            Utils.showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Telegram Bot ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        });

        async function testTelegram() {
            const statusDiv = document.getElementById('telegramStatus');
            if (!TelegramNotify.isConfigured()) {
                statusDiv.innerHTML = '<div class="alert alert-warning"><i class="fas fa-exclamation-circle"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Bot Token ‡πÅ‡∏•‡∏∞ Chat ID ‡∏Å‡πà‡∏≠‡∏ô</div>';
                return;
            }
            statusDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</div>';

            const result = await TelegramNotify.send('üß™ *‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô*\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô - ‡∏Å‡∏≠‡∏á‡∏û‡∏±‡∏ô‡∏ó‡∏´‡∏≤‡∏£‡∏£‡∏≤‡∏ö');

            if (result.success) {
                statusDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle"></i> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Telegram ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>';
            } else {
                statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-times-circle"></i> ${result.message}</div>`;
            }
        }

        async function testConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            if (!GoogleSheets.isConfigured()) {
                statusDiv.innerHTML = '<div class="alert alert-warning"><i class="fas fa-exclamation-circle"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏Å‡πà‡∏≠‡∏ô</div>';
                return;
            }
            statusDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</div>';

            try {
                const response = await fetch(GoogleSheets.WEB_APP_URL + '?action=test');
                statusDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle"></i> ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>';
            } catch (error) {
                statusDiv.innerHTML = '<div class="alert alert-danger"><i class="fas fa-times-circle"></i> ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ (‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô CORS ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á Sync ‡πÑ‡∏î‡πâ)</div>';
            }
        }

        async function syncNow() {
            const statusDiv = document.getElementById('connectionStatus');
            if (!GoogleSheets.isConfigured()) {
                statusDiv.innerHTML = '<div class="alert alert-warning"><i class="fas fa-exclamation-circle"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏Å‡πà‡∏≠‡∏ô</div>';
                return;
            }
            statusDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á Sync...</div>';

            const result = await GoogleSheets.syncToSheets();

            if (result.success) {
                statusDiv.innerHTML = '<div class="alert alert-success"><i class="fas fa-check-circle"></i> Sync ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>';
            } else {
                statusDiv.innerHTML = `<div class="alert alert-danger"><i class="fas fa-times-circle"></i> ${result.message}</div>`;
            }
        }

        function toggleAutoSync() {
            const enabled = document.getElementById('autoSyncToggle').checked;
            if (enabled) {
                AutoSync.start();
                Utils.showToast('‡πÄ‡∏õ‡∏¥‡∏î Auto Sync', 'success');
            } else {
                AutoSync.stop();
                Utils.showToast('‡∏õ‡∏¥‡∏î Auto Sync', 'info');
            }
        }

        document.getElementById('inventoryForm').addEventListener('submit', function (e) {
            e.preventDefault();
            DataManager.setInventory('diesel', parseFloat(document.getElementById('dieselAmount').value) || 0);
            DataManager.setInventory('benzin95', parseFloat(document.getElementById('benzin95Amount').value) || 0);
            DataManager.setInventory('benzin91', parseFloat(document.getElementById('benzin91Amount').value) || 0);
            Utils.showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');

            if (GoogleSheets.isConfigured()) GoogleSheets.syncToSheets();
        });

        document.getElementById('addFuelForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const type = document.getElementById('addFuelType').value;
            const liters = parseFloat(document.getElementById('addLiters').value);
            const note = document.getElementById('addNote').value;
            const user = Auth.getCurrentUser();

            DataManager.addFuelToInventory(type, liters, user.id, note);
            Utils.showToast(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${Utils.getFuelTypeName(type)} ${Utils.formatNumber(liters)} ‡∏•‡∏¥‡∏ï‡∏£ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
            loadInventory();
            this.reset();

            // Send Telegram notification
            if (TelegramNotify.isConfigured()) {
                TelegramNotify.notifyFuelReceived(type, liters, note);
            }

            if (GoogleSheets.isConfigured()) GoogleSheets.syncToSheets();
        });

        function backupData() {
            const data = DataManager.exportAllData();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `fuel_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            Utils.showToast('‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = async function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (!await Utils.confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?')) return;
                    DataManager.importData(data);
                    Utils.showToast('‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    loadInventory();
                } catch (err) {
                    Utils.showToast('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'danger');
                }
            };
            reader.readAsText(file);
        }

        async function resetSystem() {
            if (!await Utils.confirm('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?')) return;
            DataManager.resetData();
            Utils.showToast('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            loadInventory();
        }
    </script>
</body>

</html>